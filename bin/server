#!/usr/bin/env node

var http = require('http'),
    urlroute = require('url');
    port = 8080,
    numreq = 0,
    url = 'http://localhost:' + port + '/';
/* We can access nodejitsu enviroment variables from process.env */
/* Note: the SUBDOMAIN variable will always be defined for a nodejitsu app */
if(process.env.SUBDOMAIN){
  url = 'http://' + process.env.SUBDOMAIN + '.jit.su/';
}



function serve(route, handle) {
	function onRequest (req, res) {
		var pathname = urlroute.parse(req.url).pathname
		numreq +=1
		console.log('request recieved ' + numreq + "times!\n");
		console.log("request for " + pathname + " received.");
		
		route(handle, pathname);

		res.writeHead(200, {'Content-Type': 'text/plain'});
		res.write('hello, I know nodejitsu! OLOLO\n');
		res.write('request for ' + pathname + ', request recieved '+ numreq + ' times\n');
		res.end();
	}
	http.createServer(onRequest).listen(port);
	console.log('The http server has started at: ' + url);
}

exports.serve = serve;